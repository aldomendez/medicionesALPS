/*! medicionesAlps 2014-02-09*/
var Addr,Carrier,addr,ca,data,loadNew,r;data=[],NProgress.configure({showSpinner:!1}),Carrier=function(){function a(){}return a.prototype.setCarrier=function(a){return this.carrier=a,this.setDefaults(),this.pluckCarriers(),this.pluckProcess(),this.sort(),r.set("carrier",this.carrier),NProgress.done()},a.prototype.setDefaults=function(){var a,b,c,d,e,f;for(b={MEAS_X:"",MEAS_Y:"",MEAS_T:""},e=this.carrier,f=[],c=0,d=e.length;d>c;c++)a=e[c],f.push(_.defaults(a,b));return f},a.prototype.pluckCarriers=function(){var a;return a=_.keys(_.groupBy(this.carrier,function(a){return a.SYSTEM_ID})),r.set("involvedMachines",a)},a.prototype.pluckProcess=function(){var a;return a=_.keys(_.groupBy(this.carrier,function(a){return a.PART_CODE_NAME})),r.set("process_performed",a)},a.prototype.sort=function(){return this.carrier=_.sortBy(this.carrier,function(a){return("00"+a.CARRIER_SITE).slice(-2)})},a.prototype.setStoredData=function(a){return this.rawCapturedData=a,0===a.length?r.set("action","save"):r.set("action","update")},a.prototype.consolidateData=function(){return 0!==this.rawCapturedData.length?r.set("carrier",this.rawCapturedData):void 0},a}(),Addr=function(){function a(){this.valid=!1,this.patrn=/#\/carrier\/(\d{9})/,this.test()}return a.prototype.test=function(){return this.carrier=this.patrn.exec(window.location.hash),this.carrier&&null!=this.carrier[1]&&9===this.carrier[1].length&&!isNaN(this.carrier[1])?(this.valid=!0,r.set("lookupCarrier",this.carrier[1])):void 0},a.prototype.setbyCarrier=function(a){return window.location.hash="./#/carrier/"+a},a}(),r=new Ractive({el:"#output",template:"#template",data:{carrier:data,action:"save",lookupCarrier:"",involvedMachines:[],process_performed:[],warns:0,editing:!1,isGood:function(a,b){var c;return c=!1,"X"===b?c=a>=-.01&&.01>=a:"Y"===b?c=a>=-.03&&.03>=a:"T"===b?c=a>=-.018&&.18>=a:"Z"===b&&(c=a>=-.018&&.18>=a),c?"positive":"warning"}}}),loadNew=function(a){var b,c;return NProgress.start(),c=$.getJSON("php/getMxOptixData.php",{carrier:a}),c.done(function(a){return ca.setCarrier(a),NProgress.inc(),console.log("MxOptix")}),c.fail(function(){return NProgress.done()}),b=$.getJSON("php/getMxAppsData.php",{carrier:a}),b.done(function(a){return ca.setStoredData(a),NProgress.inc(),console.log("MxApps")}),b.fail(function(){return NProgress.done()}),$.when(b,c).done(function(){return ca.consolidateData(),NProgress.done(),console.log("When")})},r.on("saveData",function(){var a;return NProgress.start(),a=$.post("php/saveMeasures.php",{data:r.data.carrier,action:r.data.action}),a.done(function(){}),NProgress.done()}),r.observe("lookupCarrier",function(a){return 9===a.toString().length?(r.set("actualCarrier",a),loadNew(a)):r.set("actualCarrier","")}),ca=new Carrier,ca.setCarrier(data),addr=new Addr;